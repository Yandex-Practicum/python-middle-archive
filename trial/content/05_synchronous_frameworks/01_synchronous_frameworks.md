# Синхронные фреймворки

Синхронные фреймворки обрабатывают входящие запросы в отдельных потоках. Например, если к серверу отправят 10 запросов, то он создаст 10 потоков. В модуле «Admin panel» вы рассмотрите реализацию этого паттерна, попробуете написать свой [wsgi](https://www.python.org/dev/peps/pep-3333/)-скрипт и узнаете о плюсах и минусах этого решения.

Синхронные технологии есть в каждой компании. Асинхронные фреймворки пока довольно молоды, поэтому синхронные будут использоваться ещё продолжительное время. 

Достоинство таких фреймворков в их простоте. Во время исполнения не нужно учитывать никаких нюансов, кроме особенностей питоновского рантайма. Но важно помнить, что всё работает в многопоточной среде. Например, если вы работаете над глобальным объектом, который может изменяться во время обработки HTTP-запроса, то нужно использовать мьютексы. Это блокировки для синхронизации доступа к общим данным между потоками.

Синхронные фреймворки довольно прожорливые. На каждый запрос они создают поток, под который вдобавок выделяется стек. У приложения ограничено число потоков, которое оно может создавать. То есть в пик нагрузки сервер обработает только фиксированное количество запросов. Согласитесь, приложению будет сложно обработать 10 тысяч запросов одновременно.

## Фреймворки

## Django

Django — один из самых популярных и мощных фреймворков. Чаще всего его используют для разработки сложных сайтов и веб-приложений. На Django реализованы такие большие проекты как Instagram, Pinterest, YouTube и Spotify.

Девиз Django: «**The web framework for perfectionists with deadlines**». У фреймворка есть широкий пул возможностей: 

- панель администратора;
- работа с БД через ORM (Object-Relational Mapping);
- гибкий шаблонизатор для рендеринга HTML;
- безопасность приложения;
- ролевая модель доступа;
- работа с формами.

Благодаря этим возможностям, на Django легко начинать любой проект. Широкая функциональность не делает фреймворк сложным. Разработчику не придётся тратить время на продумывание архитектуры кода приложения. 

При всех позитивных чертах Django обладает рядом недостатков, которые могут оказаться критичными для некоторых проектов. Вся экосистема фреймворка завязана на встроенную ORM, ****которая работает только с реляционными СУБД: PostgreSQL, MySQL, Oracle, MS SQL, Sqlite. То есть, если ваш проект планирует использовать MongoDB или Cassandra, то Django — не лучший выбор. Производительность ORM хромает на сложных запросах. В Django реализованы множество стандартных механизмов. Независимо от того, пользуетесь вы ими или нет, они все равно будут выполнятся, что увеличит время ответа сервера.

Эту проблему интересно решает Instagram. У него большая кодовая база, которую разработчики писали 10 лет на Django. Сейчас им уже сложно отказаться в пользу более производительного решения. Разработчикам повезло, что приложение приносит достаточно денег, и они могут позволить себе выдерживать высокие нагрузки благодаря [вертикальному и горизонтальному масштабированию](https://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D1%81%D1%88%D1%82%D0%B0%D0%B1%D0%B8%D1%80%D1%83%D0%B5%D0%BC%D0%BE%D1%81%D1%82%D1%8C#%D0%92%D0%B5%D1%80%D1%82%D0%B8%D0%BA%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5_%D0%B8_%D0%B3%D0%BE%D1%80%D0%B8%D0%B7%D0%BE%D0%BD%D1%82%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5_%D0%BC%D0%B0%D1%81%D1%88%D1%82%D0%B0%D0%B1%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5).

Масштабирование — один из важных атрибутов высоконагруженных веб-сервисов, о которой мы будем говорить на протяжении всего курса.

## Flask

Flask — микрофреймворк, который предоставляет обработку только HTTP-запросов. Никаких встроенных ORM и шаблонизаторов в нём нет. 

Достоинство Flask — гибкость. Вы ничем не ограничены, только своей фантазией. Если программист использует Flask, то стандартных возможностей фреймворка, как правило, ему не хватает. Приходится расширять возможности Flask с помощью плагинов. 

Выбор фреймворка можно сравнить с покупкой автомобиля. Django — готовый автомобиль, где уже есть кондиционер, круиз-контроль и автоматическая коробка передач. Flask — это автомобиль с базовым набором функций. У него есть только руль, колёса и двигатель. Нужны двери? Установите их самостоятельно. Хочется кондиционер? Найдите в интернете расширение.

Недостаток Flask — снова в его гибкости. Из-за того, что многое приходится реализовывать самостоятельно, вы потратите кучу времени на изобретение велосипеда. Вдобавок, у велосипеда будут баги и плохой дизайн. Это может привести к слишком долгой адаптации под новые бизнес требования. 

По причинам, которые описаны выше, Netflix тоже [выбрал Flask](https://netflixtechblog.com/automation-as-a-service-introducing-scriptflask-17a8e4ad954b#deea) для части своих сервисов. 

## Вывод

Во время реализации задачи вы не будете использовать админку, стандартный шаблонизатор Django, модуль auth и ещё большое количество готовых компонентов. Честной работы с models в сервисе у вас тоже не будет: вы будете забирать данные напрямую из поискового движка. Исходя из этого, вы не получите выгоды от ORM. Но [middleware](https://docs.djangoproject.com/en/3.0/topics/http/middleware/), которая будет работать с каждым вашим запросом, будет создавать дополнительную нагрузку. На данный момент для задачи хорошо подойдет синхронный Flask для реализации MVP с ES. 

Flask часто используется в больших и маленьких IT-компаниях для решения веб-задач. Он послужит основой в сервисе «Авторизации»: вы рассмотрите библиотеки для Flask, сравните его с другими фреймворками и попробуете исправить его синхронность.